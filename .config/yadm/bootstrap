#!/usr/bin/env zsh

SSH_REPO_URL="git@github.com:jamesandersonwalsh/dotfiles.git"

#-----------------------------------------
# Install Homebrew/packages
#-----------------------------------------

if ! command -v brew >/dev/null 2>&1; then
  echo "‚û°Ô∏è Installing homebrew..."
  /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
fi

if [ -f "$HOME/.Brewfile" ]; then
  echo "‚û°Ô∏è Installing brew packages..."
  brew bundle --global
fi

#-----------------------------------------
# Create common directores
#-----------------------------------------

if [ ! -d "$HOME/dev/work" ]; then
  echo "‚û°Ô∏è Creating work repos directory..."
  mkdir -p $HOME/dev/work
fi

if [ ! -d "$HOME/dev/personal" ]; then
  echo "‚û°Ô∏è Creating personal repos directory..."
  mkdir -p $HOME/dev/personal
fi

#-----------------------------------------
# Install oh-my-zsh
#-----------------------------------------

if [ ! -d "$ZSH" ]; then
  echo "‚û°Ô∏è Installing oh-my-zsh..."
  /bin/bash -c "$(curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.5/install.sh | bash)"
fi

source ~/.zshrc

#-----------------------------------------
# Install NVM
#-----------------------------------------

if [ ! -d "$HOME/.nvm" ]; then
  echo "‚û°Ô∏è Installing nvm..."
  /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.1/install.sh)"
fi

#-----------------------------------------
# Install TMUX Package Manager
#-----------------------------------------

git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm

#-----------------------------------------
# Download catpuccin themes for iTerm2
#-----------------------------------------
echo "Now cloning into catppuccin/iterm.git."
echo "You will still need to select the downloaded theme in iTerm once open."

git clone https://github.com/catppuccin/iterm.git ~/.config/iterm2/themes

#-----------------------------------------
# Start background apps
#-----------------------------------------

if [ -e "/Applications/1Password 7.app" ]; then
    open -a 1Password\ 7
fi

if [ -e "/Applications/Rectangle.app" ]; then
    open -a Rectangle
fi

#-----------------------------------------
# * Set yadm origin url to ssh
#-----------------------------------------

echo "‚û°Ô∏è Updating the yadm origin to ssh repo url..."
yadm remote set-url origin "$SSH_REPO_URL"

echo "üéâ Done (you may need to run \`source ~/.zshrc\` to get changes) üéâ"
